
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://rancher.github.io/elemental/quickstart/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.1, mkdocs-material-8.5.7">
    
    
      
        <title>Quickstart - Elemental - Immutable Linux for Rancher</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.20d9efc8.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#quickstart" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="https://rancher.github.io/elemental" title="Elemental - Immutable Linux for Rancher" class="md-header__button md-logo" aria-label="Elemental - Immutable Linux for Rancher" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Elemental - Immutable Linux for Rancher
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Quickstart
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Dark Mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Dark Mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 9a3 3 0 0 1 3 3 3 3 0 0 1-3 3 3 3 0 0 1-3-3 3 3 0 0 1 3-3m0-4.5c5 0 9.27 3.11 11 7.5-1.73 4.39-6 7.5-11 7.5S2.73 16.39 1 12c1.73-4.39 6-7.5 11-7.5M3.18 12a9.821 9.821 0 0 0 17.64 0 9.821 9.821 0 0 0-17.64 0Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="grey" data-md-color-accent=""  aria-label="Light Mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Light Mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5 5 5 0 0 1 5-5 5 5 0 0 1 5 5 5 5 0 0 1-5 5m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/rancher/elemental" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    rancher/elemental
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://rancher.github.io/elemental" title="Elemental - Immutable Linux for Rancher" class="md-nav__button md-logo" aria-label="Elemental - Immutable Linux for Rancher" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Elemental - Immutable Linux for Rancher
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/rancher/elemental" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    rancher/elemental
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Quickstart
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Quickstart
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
    <nav class="md-nav" aria-label="Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-elemental-teal" class="md-nav__link">
    What is Elemental Teal ?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-is-the-rancher-elemental-stack" class="md-nav__link">
    What is the Rancher Elemental Stack ?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preparing-the-cluster" class="md-nav__link">
    Preparing the cluster
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prepare-you-kubernetes-resources" class="md-nav__link">
    Prepare you kubernetes resources
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preparing-the-iso" class="md-nav__link">
    Preparing the iso
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-can-i-choose-the-kubernetes-version-and-deployer-for-the-cluster" class="md-nav__link">
    How can I choose the kubernetes version and deployer for the cluster?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-can-i-follow-what-is-going-on-behind-the-scenes" class="md-nav__link">
    How can I follow what is going on behind the scenes?
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        Architecture
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Install/Upgrade
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Install/Upgrade" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Install/Upgrade
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../upgrade/" class="md-nav__link">
        Upgrade
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../customizing/" class="md-nav__link">
        Custom Images
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../elemental-plans/" class="md-nav__link">
        Elemental plans
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cloud-config-reference/" class="md-nav__link">
        Cloud-config reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../machineregistration-reference/" class="md-nav__link">
        MachineRegistration reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../machineinventoryselectortemplate-reference/" class="md-nav__link">
        MachineInventorySelectorTemplate reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cluster-reference/" class="md-nav__link">
        Cluster reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../elementaloperatorchart-reference/" class="md-nav__link">
        Elemental Operator Helm Chart
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetesversions/" class="md-nav__link">
        Kubernetes versions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../smbios/" class="md-nav__link">
        Smbios
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Backup
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Backup" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Backup
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../backup/" class="md-nav__link">
        Backup
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/rancher/elemental/edit/main/docs/quickstart.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="quickstart">Quickstart<a class="headerlink" href="#quickstart" title="Permanent link">&para;</a></h1>
<p>Follow this guide to have an auto-deployed cluster via rke2/k3s and managed by Rancher 
with the only help of an Elemental Teal iso</p>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<hr />
<h4 id="what-is-elemental-teal">What is Elemental Teal ?<a class="headerlink" href="#what-is-elemental-teal" title="Permanent link">&para;</a></h4>
<p>Elemental Teal is the combination of "SLE Micro for Rancher" with the Rancher Elemental stack</p>
<p>SLE Micro for Rancher is a containerized and "stripped to the bones" operating system layer. It only requires grub2, dracut, a kernel, and systemd.</p>
<p>Its sole purpose is to run Kubernetes (k3s or RKE2), with everything controlled through Rancher Manager.</p>
<p>Elemental Teal is built in the <a href="https://build.opensuse.org/package/show/isv:Rancher:Elemental:Stable:Teal53/node-image">openSUSE Build Service</a>
and available through the <a href="http://registry.opensuse.org/isv/rancher/elemental/stable/teal53/15.4/rancher/elemental-node-image/5.3:latest">openSUSE Registry</a></p>
<h4 id="what-is-the-rancher-elemental-stack">What is the Rancher Elemental Stack ?<a class="headerlink" href="#what-is-the-rancher-elemental-stack" title="Permanent link">&para;</a></h4>
<p>The Elemental Stack consists of some packages on top of SLE Micro for Rancher</p>
<ul>
<li><strong>elemental-toolkit</strong> - includes a set of OS utilities to enable OS management via containers. Includes dracut modules, bootloader configuration, cloud-init style configuration services, etc.</li>
<li><strong>elemental-operator</strong> - this connects to Rancher Manager and handles machineRegistration and machineInventory CRDs</li>
<li><strong>elemental-register</strong> - this registers machines via machineRegistrations and installs them via elemental-cli</li>
<li><strong>elemental-cli</strong> - this installs any elemental-toolkit based derivative. Basically an installer based on our A/B install and upgrade system</li>
<li><strong>rancher-system-agent</strong> - runs on the installed system and gets instructions ("Plans") from Rancher Manager what to install and run on the system</li>
</ul>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h2>
<ul>
<li>A Rancher server (2.6.9) configured (server-url set)<ul>
<li>To configure the Rancher server-url please check the <a href="https://rancher.com/docs/rancher/v2.6/en/admin-settings/#first-log-in">Rancher docs</a></li>
</ul>
</li>
<li>A machine (bare metal or virtualized) with TPM 2.0<ul>
<li>Hint 1: Libvirt allows setting virtual TPMs for virtual machines <a href="https://rancher.github.io/elemental/tpm/#add-tpm-module-to-virtual-machine">example here</a></li>
<li>Hint 2: You can enable TPM emulation on bare metal machines missing the TPM 2.0 module <a href="https://rancher.github.io/elemental/tpm/#add-tpm-emulation-to-bare-metal-machine">example here</a></li>
</ul>
</li>
<li>Helm Package Manager (https://helm.sh/)</li>
<li>Docker (for iso manipulation)</li>
</ul>
<h2 id="preparing-the-cluster">Preparing the cluster<a class="headerlink" href="#preparing-the-cluster" title="Permanent link">&para;</a></h2>
<p>elemental-operator is the management endpoint, running the management 
cluster and taking care of creating inventories, registrations for machines and much more.</p>
<p>We will use the Helm package manager to install the elemental-operator chart into our cluster</p>
<div class="highlight"><pre><span></span><code>helm upgrade --create-namespace -n cattle-elemental-system --install elemental-operator oci://registry.opensuse.org/isv/rancher/elemental/stable/charts/elemental/elemental-operator
</code></pre></div>
<p>There is a few options that can be set in the chart install but that is out of scope for this document. You can see all the values on the chart <a href="https://github.com/rancher/elemental-operator/blob/main/chart/values.yaml">values.yaml</a></p>
<p>Now after a few seconds you should see the operator pod appear on the <code>cattle-elemental-system</code> namespace.</p>
<div class="highlight"><pre><span></span><code>kubectl get pods -n cattle-elemental-system
NAME                                  READY   STATUS    RESTARTS   AGE
elemental-operator-64f88fc695-b8qhn   <span class="m">1</span>/1     Running   <span class="m">0</span>          16s
</code></pre></div>
<h2 id="prepare-you-kubernetes-resources">Prepare you kubernetes resources<a class="headerlink" href="#prepare-you-kubernetes-resources" title="Permanent link">&para;</a></h2>
<p>Node deployment starts with a <code class="highlight"><span class="l l-Scalar l-Scalar-Plain">MachineRegistration</span><span class="w"></span></code>, identifying a set of machines sharing the same configuration (disk drives, network, etc.)</p>
<p>Then it continues with having a Cluster resource that uses a <code class="highlight"><span class="l l-Scalar l-Scalar-Plain">MachineInventorySelectorTemplate</span><span class="w"></span></code> to know which machines are for that cluster.</p>
<p>This selector is a simple matcher based on labels set in the <code class="highlight"><span class="l l-Scalar l-Scalar-Plain">MachineInventory</span><span class="w"></span></code>, so if your selector is matching the <code>cluster-id</code> key with a value <code>myId</code> 
and your <code class="highlight"><span class="l l-Scalar l-Scalar-Plain">MachineInventory</span><span class="w"></span></code> has that same key with that value, it will match and be bootstrapped as part of the cluster.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Manually creating the resource yamls</label><label for="__tabbed_1_2">Using quickstart files from Elemental repo directly</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>You will need to create the following files.</p>
<div class="highlight"><span class="filename">selector.yaml</span><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">elemental.cattle.io/v1beta1</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MachineInventorySelectorTemplate</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-machine-selector</span><span class="w"></span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fleet-default</span><span class="w"></span>
<span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">selector</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">matchExpressions</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">location</span><span class="w"></span>
<span class="w">            </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">In</span><span class="w"></span>
<span class="w">            </span><span class="nt">values</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">&#39;europe&#39;</span><span class="w"> </span><span class="p p-Indicator">]</span><span class="w"></span>
</code></pre></div>
<p>As you can see this is a very simple selector that checks the key <code>node-location</code> for the value <code>europe</code></p>
<div class="highlight"><span class="filename">cluster.yaml</span><pre><span></span><code><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Cluster</span><span class="w"></span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">provisioning.cattle.io/v1</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-cluster</span><span class="w"></span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fleet-default</span><span class="w"></span>
<span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">rkeConfig</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">machinePools</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">controlPlaneRole</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">        </span><span class="nt">etcdRole</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">        </span><span class="nt">machineConfigRef</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">elemental.cattle.io/v1beta1</span><span class="w"></span>
<span class="w">          </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MachineInventorySelectorTemplate</span><span class="w"></span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-machine-selector</span><span class="w"></span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pool1</span><span class="w"></span>
<span class="w">        </span><span class="nt">quantity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"></span>
<span class="w">        </span><span class="nt">unhealthyNodeTimeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0s</span><span class="w"></span>
<span class="w">        </span><span class="nt">workerRole</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">  </span><span class="nt">kubernetesVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1.23.7+k3s1</span><span class="w"></span>
</code></pre></div>
<p>As you can see we are setting that our <code class="highlight"><span class="l l-Scalar l-Scalar-Plain">machineConfigRef</span><span class="w"></span></code> is of Kind <code class="highlight"><span class="l l-Scalar l-Scalar-Plain">MachineInventorySelectorTemplate</span><span class="w"></span></code> with the name <code>my-machine-selector</code>, which matches the selector we created.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>To know more about the <code class="highlight"><span class="l l-Scalar l-Scalar-Plain">Cluster</span><span class="w"></span></code> resource check <a href="../cluster-reference/">here</a></p>
</div>
<div class="highlight"><span class="filename">registration.yaml</span><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">elemental.cattle.io/v1beta1</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MachineRegistration</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-nodes</span><span class="w"></span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fleet-default</span><span class="w"></span>
<span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">config</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">cloud-config</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">users</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span><span class="w"></span>
<span class="w">          </span><span class="nt">passwd</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span><span class="w"></span>
<span class="w">    </span><span class="nt">elemental</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">install</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">reboot</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">        </span><span class="nt">device</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/dev/sda</span><span class="w"></span>
<span class="w">        </span><span class="nt">debug</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">  </span><span class="nt">machineName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-machine</span><span class="w"></span>
<span class="w">  </span><span class="nt">machineInventoryLabels</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">location</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;europe&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">manufacturer</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${System</span><span class="nv"> </span><span class="s">Information/Manufacturer}&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">productName</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${System</span><span class="nv"> </span><span class="s">Information/Product</span><span class="nv"> </span><span class="s">Name}&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">serialNumber</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${System</span><span class="nv"> </span><span class="s">Information/Serial</span><span class="nv"> </span><span class="s">Number}&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">machineUUID</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${System</span><span class="nv"> </span><span class="s">Information/UUID}&quot;</span><span class="w"></span>
</code></pre></div>
<p>This creates a <code class="highlight"><span class="l l-Scalar l-Scalar-Plain">MachineRegistration</span><span class="w"></span></code> which will provide a unique URL which we will use with <code>elemental-register</code> to register
the node during installation, so the operator can create a <code class="highlight"><span class="l l-Scalar l-Scalar-Plain">MachineInventory</span><span class="w"></span></code> which will be using to bootstrap the node.
See that we set the label that match our selector here already, although it can always be added later to the <code class="highlight"><span class="l l-Scalar l-Scalar-Plain">MachineInventory</span><span class="w"></span></code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Make sure to modify the registration.yaml above to set the proper install device to point to a valid device based on your node configuration(i.e. /dev/sda, /dev/vda, /dev/nvme0, etc...)</p>
</div>
<p>Now that we have all the configuration to create the proper resources in Kubernetes just apply them</p>
<div class="highlight"><pre><span></span><code>kubectl apply -f selector.yaml 
kubectl apply -f cluster.yaml 
kubectl apply -f registration.yaml
</code></pre></div>
</div>
<div class="tabbed-block">
<p>You can directly apply the quickstart example resource files from the <a href="https://github.com/rancher/elemental">Elemental repository</a></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This assumes that your Node will have a <code>/dev/sda</code> disk available as that is the default device selected in those files.
If your node doesnt have that device you will have to manually create the registration.yaml file or download the one from the repo and modify before applying</p>
</div>
<div class="highlight"><pre><span></span><code>kubectl apply -f https://raw.githubusercontent.com/rancher/elemental/main/examples/quickstart/selector.yaml
kubectl apply -f https://raw.githubusercontent.com/rancher/elemental/main/examples/quickstart/cluster.yaml
kubectl apply -f https://raw.githubusercontent.com/rancher/elemental/main/examples/quickstart/registration.yaml
</code></pre></div>
</div>
</div>
</div>
<h2 id="preparing-the-iso">Preparing the iso<a class="headerlink" href="#preparing-the-iso" title="Permanent link">&para;</a></h2>
<p>Now this is the last step, we need to prepare an Elemental Teal iso that includes the initial registration config, so
it can be auto registered, installed and fully deployed as part of our cluster. The contents of the file are nothing 
more than the registration url that the node needs to register and the proper server certificate, so it can connect securely.
This iso then can be used to provision an infinite number of machines</p>
<p>Now, our <code class="highlight"><span class="l l-Scalar l-Scalar-Plain">MachineRegistration</span><span class="w"></span></code> provides the needed config in its resource as part of its <code class="highlight"><span class="l l-Scalar l-Scalar-Plain">Status.RegistrationURL</span><span class="w"></span></code>,
so we can use that url to obtain the proper yaml needed for the iso.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">One liner</label><label for="__tabbed_2_2">Full explanation</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>wget --no-check-certificate <span class="sb">`</span>kubectl get machineregistration -n fleet-default my-nodes -o <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&quot;{.status.registrationURL}&quot;</span><span class="sb">`</span> -O initial-registration.yaml
</code></pre></div>
<p>This will download the proper yaml from the registration URL and store it on the current directory under the <code>initial-registration.yaml</code> name</p>
</div>
<div class="tabbed-block">
<p>First we need to obtain the <code class="highlight"><span class="l l-Scalar l-Scalar-Plain">RegistrationURL</span><span class="w"></span></code> that was generated for our <code class="highlight"><span class="l l-Scalar l-Scalar-Plain">MachineRegistration</span><span class="w"></span></code>
<div class="highlight"><pre><span></span><code>$ kubectl get machineregistration -n fleet-default my-test-registration -o <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&quot;{.status.registrationURL}&quot;</span>
https://172.18.0.2.sslip.io/elemental/registration/gsh4n8nj9gvbsjk4x7hxvnr5l6hmhbdbdffrmkwzrss2dtfbnpbmqp
</code></pre></div>
Then we need to visit that URL as that will provide the URL and CA certificate for unauthenticated requests:
<div class="highlight"><pre><span></span><code>$ curl --insecure https://172.18.0.2.sslip.io/elemental/registration/gsh4n8nj9gvbsjk4x7hxvnr5l6hmhbdbdffrmkwzrss2dtfbnpbmqp

elemental:
  registration:
    url: https://172.18.0.2.sslip.io/elemental/registration/gsh4n8nj9gvbsjk4x7hxvnr5l6hmhbdbdffrmkwzrss2dtfbnpbmqp
    ca-cert: <span class="p">|</span>-
      -----BEGIN CERTIFICATE-----
      MIIBqDCCAU2gAwIBAgIBADAKBggqhkjOPQQDAjA7MRwwGgYDVQQKExNkeW5hbWlj
      bGlzdGVuZXItb3JnMRswGQYDVQQDExJkeW5hbWljbGlzdGVuZXItY2EwHhcNMjIw
      ODA0MTA1OTE1WhcNMzIwODAxMTA1OTE1WjA7MRwwGgYDVQQKExNkeW5hbWljbGlz
      dGVuZXItb3JnMRswGQYDVQQDExJkeW5hbWljbGlzdGVuZXItY2EwWTATBgcqhkjO
      PQIBBggqhkjOPQMBBwNCAASa8PJH7JJGT5QUPMBYnJe0j50G7dTEaDlk4xRpqVk1
      y4dloslsI0RTb6B++7nNgnLPOe2KqZfylNmVIAelrSaUo0IwQDAOBgNVHQ8BAf8E
      BAMCAqQwDwYDVR0TAQH/BAUwAwEB/zAdBgNVHQ4EFgQUxp8OBfjZlnyV6pzzKqIF
      wWByvCYwCgYIKoZIzj0EAwIDSQAwRgIhAPI2XUWcnxkkBe98SGPFa1Hlncyu/FCR
      AbEYIAdUC2z+AiEA+GizukSRiiLV28wdNdKihEELy+qzi5MlVYowUuQYZsA<span class="o">=</span>
      -----END CERTIFICATE-----
</code></pre></div></p>
<p>As you can see we obtained the proper initial registration needed by <code>elemental-register</code> to register the node properly and continue with the automated installation</p>
<p>Now we can write down the data returned for that url into a file that we will inject into the iso</p>
<div class="highlight"><span class="filename">initial-registration.yaml</span><pre><span></span><code><span class="nt">elemental</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">registration</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://172.18.0.2.sslip.io/elemental/registration/gsh4n8nj9gvbsjk4x7hxvnr5l6hmhbdbdffrmkwzrss2dtfbnpbmqp</span><span class="w"></span>
<span class="w">    </span><span class="nt">ca-cert</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span><span class="w"></span>
<span class="w">      </span><span class="no">-----BEGIN CERTIFICATE-----</span><span class="w"></span>
<span class="w">      </span><span class="no">MIIBqDCCAU2gAwIBAgIBADAKBggqhkjOPQQDAjA7MRwwGgYDVQQKExNkeW5hbWlj</span><span class="w"></span>
<span class="w">      </span><span class="no">bGlzdGVuZXItb3JnMRswGQYDVQQDExJkeW5hbWljbGlzdGVuZXItY2EwHhcNMjIw</span><span class="w"></span>
<span class="w">      </span><span class="no">ODA0MTA1OTE1WhcNMzIwODAxMTA1OTE1WjA7MRwwGgYDVQQKExNkeW5hbWljbGlz</span><span class="w"></span>
<span class="w">      </span><span class="no">dGVuZXItb3JnMRswGQYDVQQDExJkeW5hbWljbGlzdGVuZXItY2EwWTATBgcqhkjO</span><span class="w"></span>
<span class="w">      </span><span class="no">PQIBBggqhkjOPQMBBwNCAASa8PJH7JJGT5QUPMBYnJe0j50G7dTEaDlk4xRpqVk1</span><span class="w"></span>
<span class="w">      </span><span class="no">y4dloslsI0RTb6B++7nNgnLPOe2KqZfylNmVIAelrSaUo0IwQDAOBgNVHQ8BAf8E</span><span class="w"></span>
<span class="w">      </span><span class="no">BAMCAqQwDwYDVR0TAQH/BAUwAwEB/zAdBgNVHQ4EFgQUxp8OBfjZlnyV6pzzKqIF</span><span class="w"></span>
<span class="w">      </span><span class="no">wWByvCYwCgYIKoZIzj0EAwIDSQAwRgIhAPI2XUWcnxkkBe98SGPFa1Hlncyu/FCR</span><span class="w"></span>
<span class="w">      </span><span class="no">AbEYIAdUC2z+AiEA+GizukSRiiLV28wdNdKihEELy+qzi5MlVYowUuQYZsA=</span><span class="w"></span>
<span class="w">      </span><span class="no">-----END CERTIFICATE-----</span><span class="w"></span>
</code></pre></div>
</div>
</div>
</div>
<p>Now we can proceed to create the ISO</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:1"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">Via script</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>We provide a ISO build script for ease of use that can get the final ISO and inject the <code>initial-registration.yaml</code>:</p>
<div class="highlight"><pre><span></span><code>wget -q https://raw.githubusercontent.com/rancher/elemental/main/.github/elemental-iso-add-registration <span class="o">&amp;&amp;</span> chmod +x elemental-iso-add-registration
</code></pre></div>
<p>Now that we have the script we can proceed to download the ISO and inject our configuration injected:</p>
<div class="highlight"><pre><span></span><code>./elemental-iso-add-registration initial-registration.yaml
</code></pre></div>
<p>This will generate an ISO on the current directory with the name <code>elemental-teal-&lt;ARCH&gt;.iso</code></p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>The script uses the iso for the arch based on the system is being run from. If you want to cross build for another system,
you can set the <code>ARCH</code> environment variable to the desired target system (x86_64, aarch64) and the iso will be build for that architecture.</p>
</div>
</div>
</div>
</div>
<p>You can now boot your nodes with this ISO, and they will:</p>
<ul>
<li>Boot from the ISO</li>
<li>Register with the registrationURL given and create a per-machine <code class="highlight"><span class="l l-Scalar l-Scalar-Plain">MachineInventory</span><span class="w"></span></code></li>
<li>Install Elemental Teal to the given device</li>
<li>Restart</li>
<li>Auto-deploy the cluster via k3s</li>
</ul>
<p>After a few minutes your new cluster will be fully provisioned!!</p>
<h2 id="how-can-i-choose-the-kubernetes-version-and-deployer-for-the-cluster">How can I choose the kubernetes version and deployer for the cluster?<a class="headerlink" href="#how-can-i-choose-the-kubernetes-version-and-deployer-for-the-cluster" title="Permanent link">&para;</a></h2>
<p>On you cluster.yaml file there is a key in the <code class="highlight"><span class="l l-Scalar l-Scalar-Plain">Spec</span><span class="w"></span></code> called <code class="highlight"><span class="l l-Scalar l-Scalar-Plain">kubernetesVersion</span><span class="w"></span></code>. That sets the version and deployer that will be used for the cluster,
for example for rke <code>v1.23.6</code> while for rke2 would be <code>v1.23.6+rke2r1</code> and for k3s <code>v1.23.6+k3s1</code></p>
<p>To see all compatible versions check the <a href="https://www.suse.com/suse-rancher/support-matrix/all-supported-versions/">Rancher Support Matrix</a> PDF for rke/rke2/k3s versions and their components.</p>
<p>You can also check our <a href="../kubernetesversions/">Version doc</a> to know how to obtain those versions.</p>
<p>Check our <a href="../cluster-reference/">Cluster Spec</a> page for more info about the <code class="highlight"><span class="l l-Scalar l-Scalar-Plain">Cluster</span><span class="w"></span></code> resource.</p>
<h2 id="how-can-i-follow-what-is-going-on-behind-the-scenes">How can I follow what is going on behind the scenes?<a class="headerlink" href="#how-can-i-follow-what-is-going-on-behind-the-scenes" title="Permanent link">&para;</a></h2>
<p>You should be able to follow along what the machine is doing via:</p>
<ul>
<li>During ISO boot:<ul>
<li>ssh into the machine (user/pass: root/ros):<ul>
<li>running <code>journalctl -f -t elemental</code> will show you the output of the elemental-register and the elemental install</li>
</ul>
</li>
</ul>
</li>
<li>Once the system is installed:<ul>
<li>On the Rancher UI -&gt; <code>Cluster Management</code> you should see your new cluster and be able to see the <code>Provisioning Log</code> in the cluster details</li>
<li>ssh into the machine (user/pass: Whatever your configured on the registration.yaml under <code>Spec.config.cloud-config.users</code>):<ul>
<li>running <code>journalctl -f -u elemental-system-agent</code> will show the output of the initial elemental config and install of <code>rancher-system-agent</code></li>
<li>running <code>journalctl -f -u rancher-system-agent</code> will show the output of the boostrap of cluster components like k3s</li>
<li>running <code>journalctl -f -u k3s</code> will show the logs of the k3s deployment</li>
</ul>
</li>
</ul>
</li>
</ul>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href=".." class="md-footer__link md-footer__link--prev" aria-label="Previous: Overview" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Overview
            </div>
          </div>
        </a>
      
      
        
        <a href="../architecture/" class="md-footer__link md-footer__link--next" aria-label="Next: Architecture" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Architecture
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["toc.integrate"], "search": "../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.8492ddcf.min.js"></script>
      
    
  </body>
</html>